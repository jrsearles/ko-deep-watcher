// ko-deep-watcher 1.0.0 - Deeply and dynamically observe an object hierarchy | (c) 2015 Joshua Searles |  http://www.opensource.org/licenses/mit-license
!function(e,t){"function"==typeof define&&define.amd?define(["knockout","WeakMap"],t):"object"==typeof exports?module.exports=t(require("knockout"),require("WeakMap")):t(e.ko,e.WeakMap)}(this,function(e,t){"use strict";function n(e){return e&&"object"==typeof e}function r(t){return e.isObservable(t)&&"push"in t}function u(e){return e[a]!==!1}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){if(l(e))for(var r=0,u=e.length;u>r;r++)t(e[r],r,e);else if(n(e))for(var s in e)i(e,s)&&t(e[s],s,e)}var a="_watchable",o="deep",c=function(){return!0},f=function(e){return e},l=Array.isArray||function(e){return null!=e&&"[object Array]"===Object.prototype.toString.call(e)},p=Object.assign||function(){for(var t=arguments[0],n=1,r=arguments.length;r>n;n++)t=e.utils.extend(t,arguments[n]);return t},b=e.watch=function(i,a,o){function f(e){return function(t,n,r){o.valueAccessor&&(t=o.valueAccessor(t,n,r)),e(t,n,r)}}function d(t,r,u){if(t)if(e.isSubscribable(t))h(t,r,u);else if(l(t))s(t,f(d));else if(n(t)){if(e.utils.arrayIndexOf(g,t)>=0)return;g.push(t),s(t,f(d))}}function v(t){if(t){e.isSubscribable(t)&&O.has(t)&&(O.get(t).dispose(),O["delete"](t),t=t.peek());var n=e.utils.arrayIndexOf(g,t);n>=0&&(g.splice(n,1),s(t,f(v)))}}function h(e,t,n){u(e)&&m(e,t,n)&&(r(e)?k(e,n):y(e,t,n),d(e.peek(),t,n))}function y(e,t,n){var r=e.peek();O.set(e,e.subscribe(function(i){v(r),u(e)&&a({target:e,parent:n,key:t,value:i,priorValue:r}),d(r=i,t,n)}))}function k(t,n){var r=t.peek().slice(0);O.set(t,t.subscribe(function(i){e.utils.arrayForEach(i,function(e){var i,s,o=!1;"moved"in e?(o=!0,"added"===e.status?(s=e.value,i=r[e.index]):(s=r[e.moved],i=e.value)):"added"===e.status?s=e.value:i=e.value,u(t)&&a({target:t,parent:n,key:e.index,value:s,priorValue:i}),o||("added"===e.status?d:v)(e.value,e.index,n)}),r=t.peek().slice(0)},null,"arrayChange"))}var g=[],O=new t;o=o?p({},b.defaultOptions,o):b.defaultOptions;var m=o.shouldWatch||c;return d(i),{dispose:function(){v(i),i=null,g=[]}}};b.defaultOptions={valueAccessor:f,shouldWatch:c};var d=e.subscribable.fn.subscribe;return e.subscribable.fn.subscribe=function(e,t,n){var r=d.apply(this,arguments);if(n===o){var u=this,i=b(u,function(e){u.notifySubscribers(e,o)}),s=r.dispose;r.dispose=function(){i.dispose(),s.call(r)}}return r},e.subscribable.fn.watch=function(e){return"function"==typeof e?this.subscribe(e,null,o):(this[a]=!!e,this)},e});